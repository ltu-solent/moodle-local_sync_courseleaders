{"version":3,"file":"mapping_actions_bulk.min.js","sources":["../src/mapping_actions_bulk.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module mapping_actions_bulk\n *\n * @module     local_sync_courseleaders/mapping_actions_bulk\n * @copyright  2025 Southampton Solent University {@link https://www.solent.ac.uk}\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {prefetchStrings} from 'core/prefetch';\nimport {getList} from 'core/normalise';\nimport Notification from 'core/notification';\nimport Ajax from 'core/ajax';\nimport Url from 'core/url';\n\nconst selectors = {\n    activeRows: 'input.mappingcheckbox:checked',\n    bulkActions: '#courseleadersmappingsbulkactions',\n    table: '#coursemodulemappings_table',\n};\n\nexport const init = () => {\n    prefetchStrings('local_sync_courseleaders', [\n        'disable',\n        'enable',\n    ]);\n    prefetchStrings('core', [\n        'delete',\n    ]);\n    registerEventListeners();\n};\n\n/**\n * Register event listeners for bulk deleting\n */\nconst registerEventListeners = () => {\n    document.querySelector(selectors.bulkActions)?.addEventListener('change', e => {\n        const action = e.target;\n        if (action.value.indexOf('#') !== -1) {\n            e.preventDefault();\n            if (action.value == '#disableselect') {\n                disableMappings();\n            }\n            if (action.value == '#enableselect') {\n                enableMappings();\n            }\n        }\n    });\n};\n\n/**\n * Confirm delete activities dialogue.\n */\nconst enableMappings = () => {\n    const table = document.querySelector(selectors.table);\n    const activeRows = getList(table.querySelectorAll(selectors.activeRows));\n    const ids = activeRows.map(item => item.value);\n    return updateMappings(ids, 1);\n};\n\nconst disableMappings = () => {\n    const table = document.querySelector(selectors.table);\n    const activeRows = getList(table.querySelectorAll(selectors.activeRows));\n    const ids = activeRows.map(item => item.value);\n    return updateMappings(ids, 0);\n};\n\n/**\n * Update mappings\n * @param {Number[]} ids Mapping ids\n * @param {Number} enabled Enable or Disable\n */\nasync function updateMappings(ids, enabled) {\n    const request = {\n        methodname: 'local_sync_courseleaders_update_mappings',\n        args: {\n            mappingids: ids,\n            enabled: enabled\n        }\n    };\n    try {\n        await Ajax.call([request])[0];\n        window.location.href = Url.relativeUrl(\n            'local/sync_courseleaders/index.php',\n            {},\n            false\n        );\n    } catch (error) {\n        Notification.exception(error);\n    }\n}\n\n"],"names":["selectors","registerEventListeners","document","querySelector","addEventListener","e","action","target","value","indexOf","preventDefault","disableMappings","enableMappings","table","updateMappings","querySelectorAll","map","item","ids","enabled","request","methodname","args","mappingids","Ajax","call","window","location","href","Url","relativeUrl","error","exception"],"mappings":";;;;;;;kNA6BMA,qBACU,gCADVA,sBAEW,oCAFXA,gBAGK,4CAGS,mCACA,2BAA4B,CACxC,UACA,yCAEY,OAAQ,CACpB,WAEJC,gCAMEA,uBAAyB,6DAC3BC,SAASC,cAAcH,+EAAwBI,iBAAiB,UAAUC,UAChEC,OAASD,EAAEE,QACkB,IAA/BD,OAAOE,MAAMC,QAAQ,OACrBJ,EAAEK,iBACkB,kBAAhBJ,OAAOE,OACPG,kBAEgB,iBAAhBL,OAAOE,OACPI,sBASVA,eAAiB,WACbC,MAAQX,SAASC,cAAcH,wBAG9Bc,gBAFY,sBAAQD,MAAME,iBAAiBf,uBAC3BgB,KAAIC,MAAQA,KAAKT,QACb,IAGzBG,gBAAkB,WACdE,MAAQX,SAASC,cAAcH,wBAG9Bc,gBAFY,sBAAQD,MAAME,iBAAiBf,uBAC3BgB,KAAIC,MAAQA,KAAKT,QACb,mBAQhBM,eAAeI,IAAKC,eACzBC,QAAU,CACZC,WAAY,2CACZC,KAAM,CACFC,WAAYL,IACZC,QAASA,oBAIPK,cAAKC,KAAK,CAACL,UAAU,GAC3BM,OAAOC,SAASC,KAAOC,aAAIC,YACvB,qCACA,IACA,GAEN,MAAOC,6BACQC,UAAUD"}